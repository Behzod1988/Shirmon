<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <title>Shirmon Bakery ‚Äî Mini App</title>
  <link rel="preconnect" href="https://telegram.org" crossorigin>
  <link rel="preload" href="products.json" as="fetch" crossorigin>
  <script src="https://telegram.org/js/telegram-web-app.js" defer></script>
  <style>
    :root{--bg:#0e0f10;--text:#e8eaed;--muted:#9aa0a6;--line:#1f2124;--card:#141518;--accent:#d9aa63;--accent-2:#fff2d9}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{display:flex;flex-direction:column;min-height:100%}
    header{position:sticky;top:0;z-index:5;backdrop-filter:blur(10px);background:rgba(14,15,16,.86);border-bottom:1px solid var(--line)}
    .head{display:flex;align-items:center;gap:12px;padding:14px 16px}
    .logo{width:38px;height:38px;border-radius:12px;background:conic-gradient(from 200deg,#202225,#2a2d31,#3a2d1a,#2a2d31);display:grid;place-items:center;border:1px solid #272a2f}
    .logo span{font-size:20px}
    .brand{display:flex;flex-direction:column}
    .brand h1{margin:0;font-size:18px;font-weight:700}
    .brand .sub{margin:2px 0 0;color:var(--muted);font-size:12px}
    .head-actions{margin-left:auto;display:flex;align-items:center;gap:8px}
    .btn{appearance:none;border:1px solid var(--line);background:#191b1f;color:var(--text);border-radius:12px;padding:10px 14px;cursor:pointer;touch-action:manipulation}
    .btn.primary{background:var(--accent);color:#2b2b2b;border:none;font-weight:700}
    .btn.ghost{background:transparent}

    nav.tabs{display:flex;gap:8px;padding:10px 12px;border-top:1px solid #0b0c0d;border-bottom:1px solid var(--line)}
    .tab{border:1px solid var(--line);background:#141518;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer;touch-action:manipulation}
    .tab.active{outline:2px solid var(--accent)}

    main{flex:1;padding:16px}
    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(210px,1fr))}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .pic{position:relative;height:150px;background:linear-gradient(135deg,#24262b,#17191d)}
    .pic img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:.96}
    .badge{position:absolute;left:10px;top:10px;font-size:12px;background:rgba(0,0,0,.5);border:1px solid #2c2f35;color:#f2f3f5;padding:4px 8px;border-radius:10px}
    .ctr{padding:12px}
    .ctr h3{margin:0 0 6px;font-size:16px}
    .muted{color:var(--muted);font-size:13px}
    .row{display:flex;align-items:center;justify-content:space-between;margin-top:10px}

    /* Drawer */
    .drawer{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:6}
    .drawer.open{display:block}
    .sheet{position:absolute;right:0;top:0;bottom:0;width:92%;max-width:420px;background:#111216;border-left:1px solid var(--line);display:flex;flex-direction:column}
    .sheet-h{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line)}
    .sheet-b{flex:1;overflow:auto;padding:8px}
    .cart-row{display:flex;gap:10px;padding:10px;border-bottom:1px dashed #2a2d2f}
    .cart-row img{width:64px;height:64px;object-fit:cover;border-radius:8px;border:1px solid #2a2d31}
    .qty{display:flex;align-items:center;gap:8px}
    .qty .q{width:32px;height:32px;border-radius:8px;border:1px solid var(--line);background:#1a1c20;color:var(--text);cursor:pointer}
    .sheet-f{border-top:1px solid var(--line);padding:12px;display:flex;flex-direction:column;gap:10px}

    .note{width:100%;resize:none;height:64px;border-radius:10px;border:1px solid var(--line);background:#121318;color:var(--text);padding:8px}

    /* Info/Contacts cards */
    .card.padded{padding:14px}
    .list{display:grid;gap:8px;margin-top:8px}

    /* Language switch */
    .lang{display:flex;gap:6px;border:1px solid var(--line);border-radius:10px;padding:4px}
    .lang button{border:none;background:transparent;color:var(--text);padding:6px 10px;border-radius:8px;cursor:pointer}
    .lang button.active{background:#202227}

    @media (min-width:760px){.pic{height:170px}}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="head">
      <div class="logo"><span>ü•®</span></div>
      <div class="brand">
        <h1 id="t_brand">Shirmon Bakery</h1>
        <div class="sub" id="t_city">–¢–∞–Ω–¥—ãÃÅ—Ä–Ω–∞—è –≤—ã–ø–µ—á–∫–∞ ‚Ä¢ –°–∞–Ω–∫—Ç‚Äë–ü–µ—Ç–µ—Ä–±—É—Ä–≥</div>
      </div>
      <div class="head-actions">
        <div class="lang" id="lang">
          <button data-l="ru" class="active">RU</button>
          <button data-l="uz">UZ</button>
        </div>
        <button id="cartBtn" class="btn">üõí <span id="cartCount">0</span></button>
      </div>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="menu" id="tab_menu">–ú–µ–Ω—é</button>
      <button class="tab" data-tab="contacts" id="tab_contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
      <button class="tab" data-tab="info" id="tab_info">–ò–Ω—Ñ–æ</button>
    </nav>
  </header>

  <main>
    <section id="view-menu" class="view">
      <div class="grid" id="products"></div>
    </section>
    <section id="view-contacts" class="view" style="display:none">
      <div class="card padded">
        <h2 id="t_contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
        <div class="list">
          <div><b id="t_phone">–¢–µ–ª–µ—Ñ–æ–Ω</b>: <a href="tel:+79210000000">+7 (921) 000‚Äë00‚Äë00</a></div>
          <div><b id="t_addr">–ê–¥—Ä–µ—Å</b>: –°–∞–Ω–∫—Ç‚Äë–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ü—Ä–∏–º–µ—Ä–Ω–∞—è 1</div>
          <div><b id="t_time">–í—Ä–µ–º—è</b>: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 09:00‚Äì21:00</div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <a class="btn" href="https://t.me/ShirmonBakeryBot" target="_blank" id="t_write">–ù–∞–ø–∏—Å–∞—Ç—å –≤ –±–æ—Ç</a>
          <a class="btn" href="https://yandex.ru/maps/" target="_blank" id="t_map">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</a>
        </div>
      </div>
    </section>
    <section id="view-info" class="view" style="display:none">
      <div class="card padded">
        <h2 id="t_about">–û Shirmon</h2>
        <p id="t_about_p">–¢–∞–Ω–¥—ãÃÅ—Ä–Ω–∞—è –ª–µ–ø—ë—à–∫–∞ –∏ —Å–∞–º—Å–∞ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º –≤–∫—É—Å–æ–º. –ü–µ—á—ë–º –∏–∑ –æ—Ç–±–æ—Ä–Ω–æ–π –º—É–∫–∏, —Ä–∞–±–æ—Ç–∞–µ–º —Å –ª—é–±–æ–≤—å—é ‚ù§Ô∏è</p>
        <ul>
          <li id="t_point1">–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É –∏ —Å–∞–º–æ–≤—ã–≤–æ–∑</li>
          <li id="t_point2">–°–∫–∏–¥–∫–∏ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 10 —à—Ç</li>
          <li id="t_point3">–ì–æ—Ä—è—á–æ –∏ —Å–≤–µ–∂–æ, –∫–∞–∫ –¥–æ–º–∞</li>
        </ul>
      </div>
    </section>
  </main>
</div>

<!-- CART DRAWER -->
<div class="drawer" id="drawer">
  <div class="sheet">
    <div class="sheet-h">
      <div style="font-weight:700" id="t_cart">–ö–æ—Ä–∑–∏–Ω–∞</div>
      <button class="btn ghost" id="closeDraw">‚úï</button>
    </div>
    <div class="sheet-b" id="cartList"></div>
    <div class="sheet-f">
      <textarea id="note" class="note" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: –∞–¥—Ä–µ—Å, –≤—Ä–µ–º—è, –æ–ø–ª–∞—Ç–∞‚Ä¶"></textarea>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><span id="t_total">–ò—Ç–æ–≥–æ</span>: <b id="sum">0 ‚ÇΩ</b></div>
        <button class="btn primary" id="checkout">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Telegram SDK init
  const tg = window.Telegram?.WebApp;
  if (tg){ tg.ready(); tg.expand(); tg.setHeaderColor('#0e0f10'); tg.setBackgroundColor('#0e0f10'); tg.MainButton.setParams({text:'–û—Ñ–æ—Ä–º–∏—Ç—å',is_visible:false}); }

  // i18n strings
  const I18N={
    ru:{menu:'–ú–µ–Ω—é',contacts:'–ö–æ–Ω—Ç–∞–∫—Ç—ã',info:'–ò–Ω—Ñ–æ',cart:'–ö–æ—Ä–∑–∏–Ω–∞',total:'–ò—Ç–æ–≥–æ',brand:'Shirmon Bakery',city:'–¢–∞–Ω–¥—ãÃÅ—Ä–Ω–∞—è –≤—ã–ø–µ—á–∫–∞ ‚Ä¢ –°–∞–Ω–∫—Ç‚Äë–ü–µ—Ç–µ—Ä–±—É—Ä–≥',
      phone:'–¢–µ–ª–µ—Ñ–æ–Ω',addr:'–ê–¥—Ä–µ—Å',time:'–í—Ä–µ–º—è',write:'–ù–∞–ø–∏—Å–∞—Ç—å –≤ –±–æ—Ç',map:'–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É',about:'–û Shirmon',about_p:'–¢–∞–Ω–¥—ãÃÅ—Ä–Ω–∞—è –ª–µ–ø—ë—à–∫–∞ –∏ —Å–∞–º—Å–∞ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º –≤–∫—É—Å–æ–º. –ü–µ—á—ë–º –∏–∑ –æ—Ç–±–æ—Ä–Ω–æ–π –º—É–∫–∏, —Ä–∞–±–æ—Ç–∞–µ–º —Å –ª—é–±–æ–≤—å—é ‚ù§Ô∏è',
      p1:'–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É –∏ —Å–∞–º–æ–≤—ã–≤–æ–∑',p2:'–°–∫–∏–¥–∫–∏ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 10 —à—Ç',p3:'–ì–æ—Ä—è—á–æ –∏ —Å–≤–µ–∂–æ, –∫–∞–∫ –¥–æ–º–∞',add:'–í –∫–æ—Ä–∑–∏–Ω—É',checkout:'–û—Ñ–æ—Ä–º–∏—Ç—å'},
    uz:{menu:'Menyu',contacts:'Aloqa',info:'Ma ºlumot',cart:'Savat',total:'Jami',brand:'Shirmon Bakery',city:'Tandir non va samsa ‚Ä¢ Sankt-Peterburg',
      phone:'Telefon',addr:'Manzil',time:'Ish vaqti',write:'Botga yozish',map:'Xaritani ochish',about:'Shirmon haqida',about_p:'Tandir non va samsa ‚Äî haqiqiy mazali ta ºm. Premium un, mehr bilan pishiramiz ‚ù§Ô∏è',
      p1:'Shahar bo ªylab yetkazib berish va olib ketish',p2:'10 donadan chegirmalar',p3:'Uyday issiq va yangi',add:'Savatga',checkout:'Rasmiylashtirish'}
  };
  let LANG='ru';

  const $=sel=>document.querySelector(sel);
  const $$=sel=>document.querySelectorAll(sel);

  // Demo products ‚Äî replace images/prices later
  const PRODUCTS=[
    {id:'lepeshka', title:{ru:'–õ–µ–ø—ë—à–∫–∞ –∏–∑ —Ç–∞–Ω–¥—ã—Ä–∞',uz:'Tandir non'}, desc:{ru:'–•—Ä—É—Å—Ç—è—â–∞—è —Å–Ω–∞—Ä—É–∂–∏, –º—è–≥–∫–∞—è –≤–Ω—É—Ç—Ä–∏',uz:'Tashqarisi qarsildoq, ichi yumshoq'}, price:120, img:''},
    {id:'samsa_beef_round', title:{ru:'–°–∞–º—Å–∞ —Å –≥–æ–≤—è–¥–∏–Ω–æ–π (–∫—Ä—É–≥–ª–∞—è)',uz:'Mol go ªshtli samsa (dumaloq)'}, desc:{ru:'–°–æ—á–Ω–∞—è –≥–æ–≤—è–¥–∏–Ω–∞, —Å–ø–µ—Ü–∏–∏',uz:'Shirali mol go ªshti, ziravorlar'}, price:170, img:''},
    {id:'samsa_pumpkin', title:{ru:'–°–∞–º—Å–∞ —Å —Ç—ã–∫–≤–æ–π',uz:'Qovoqli samsa'}, desc:{ru:'–õ—ë–≥–∫–∞—è —Å–ª–∞–¥–æ—Å—Ç—å —Ç—ã–∫–≤—ã, –∫—É–Ω–∂—É—Ç',uz:'Yengil shirin qovoq, kunjut'}, price:150, img:''},
    {id:'samsa_potato', title:{ru:'–°–∞–º—Å–∞ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π',uz:'Kartoshkali samsa'}, desc:{ru:'–î–æ–º–∞—à–Ω–∏–π –≤–∫—É—Å, –∞—Ä–æ–º–∞—Ç —Å–ø–µ—Ü–∏–π',uz:'Uy ta ºmi, ziravor hidi'}, price:140, img:''}
  ];

  const state={cart:{}, sendLock:false};

  function t(key){return I18N[LANG][key]||key}

  function setLang(l){
    LANG=l; $$('#lang button').forEach(b=>b.classList.toggle('active',b.dataset.l===l));
    // header
    $('#t_brand').textContent=t('brand');
    $('#t_city').textContent=t('city');
    // tabs
    $('#tab_menu').textContent=t('menu');
    $('#tab_contacts').textContent=t('contacts');
    $('#tab_info').textContent=t('info');
    // contacts/info
    $('#t_contacts').textContent=t('contacts');
    $('#t_phone').textContent=t('phone');
    $('#t_addr').textContent=t('addr');
    $('#t_time').textContent=t('time');
    $('#t_write').textContent=t('write');
    $('#t_map').textContent=t('map');
    $('#t_about').textContent=t('about');
    $('#t_about_p').textContent=t('about_p');
    $('#t_point1').textContent=t('p1');
    $('#t_point2').textContent=t('p2');
    $('#t_point3').textContent=t('p3');
    $('#t_cart').textContent=t('cart');
    $('#t_total').textContent=t('total');
    $('#checkout').textContent=t('checkout');
    renderProducts();
  }

  $('#lang').addEventListener('click',e=>{const b=e.target.closest('button'); if(!b) return; setLang(b.dataset.l)})

  // Tabs
  $$('.tab').forEach(btn=>btn.addEventListener('click',()=>{
    const name=btn.dataset.tab;
    $$('.tab').forEach(x=>x.classList.toggle('active',x===btn));
    $$('.view').forEach(v=>v.style.display='none');
    $('#view-'+name).style.display='block';
  }))

  // Render products
  function renderProducts(){
    const wrap=$('#products'); wrap.innerHTML='';
    PRODUCTS.forEach(p=>{
      const card=document.createElement('div'); card.className='card';
      const title=p.title[LANG]||p.title.ru; const desc=p.desc[LANG]||p.desc.ru;
      card.innerHTML=`
        <div class='pic'>${p.img?`<img src='${p.img}' alt='${title}' loading='lazy' decoding='async' fetchpriority='low'>`:''}<div class='badge'>${p.price} ‚ÇΩ</div></div>
        <div class='ctr'>
          <h3>${title}</h3>
          <div class='muted'>${desc}</div>
          <div class='row'>
            <div style='font-weight:700'>${p.price} ‚ÇΩ</div>
            <button class='btn primary' data-add='${p.id}'>${t('add')}</button>
          </div>
        </div>`;
      card.addEventListener('click',e=>{const id=e.target.getAttribute('data-add'); if(id) addToCart(id)});
      wrap.appendChild(card);
    })
  }

  // Cart logic
  function addToCart(id){
    const prod=PRODUCTS.find(x=>x.id===id); if(!prod) return;
    const cur=state.cart[id]||{qty:0,prod}; cur.qty++; state.cart[id]=cur; updateCart();
    try{ tg?.HapticFeedback?.impactOccurred?.('light'); }catch(e){}
  }
  function subFromCart(id){
    const cur=state.cart[id]; if(!cur) return; cur.qty--; if(cur.qty<=0) delete state.cart[id]; updateCart();
  }
  function updateCart(){
    const cnt=Object.values(state.cart).reduce((n,i)=>n+i.qty,0);
    $('#cartCount').textContent=cnt;
    if(tg) tg.MainButton.setParams({is_visible:cnt>0, text:t('checkout')});
    renderCart();
  }

  // Drawer
  const drawer=$('#drawer');
  $('#cartBtn').onclick=()=>drawer.classList.add('open');
  $('#closeDraw').onclick=()=>drawer.classList.remove('open');

  function renderCart(){
    const list=$('#cartList'); list.innerHTML='';
    let sum=0; Object.values(state.cart).forEach(({prod,qty})=>{
      sum+=prod.price*qty;
      const row=document.createElement('div'); row.className='cart-row';
      row.innerHTML=`
        <img src='${prod.img||''}' alt='img'>
        <div style='flex:1'>
          <div style='font-weight:700'>${prod.title[LANG]||prod.title.ru}</div>
          <div class='muted'>${prod.price} ‚ÇΩ √ó ${qty}</div>
        </div>
        <div class='qty'>
          <button class='q' data-m='${prod.id}'>‚Äì</button>
          <div>${qty}</div>
          <button class='q' data-p='${prod.id}'>+</button>
        </div>`;
      row.addEventListener('click',e=>{
        if(e.target.dataset.p) addToCart(e.target.dataset.p);
        if(e.target.dataset.m) subFromCart(e.target.dataset.m);
      })
      list.appendChild(row);
    })
    $('#sum').textContent=sum+' ‚ÇΩ';
  }

  function buildOrder(){
    const items=Object.values(state.cart).map(({prod,qty})=>({id:prod.id,title:prod.title[LANG]||prod.title.ru,price:prod.price,qty}));
    const total=items.reduce((n,i)=>n+i.price*i.qty,0);
    const note=$('#note').value.trim();
    return {lang:LANG, items, total, note, ts:Date.now()};
  }

  function sendOrder(){
    if(state.sendLock) return; state.sendLock=true; setTimeout(()=>state.sendLock=false,1500);
    const order=buildOrder();
    if(tg){ tg.sendData(JSON.stringify(order)); tg.close(); }
    else alert('–û—Ç–∫—Ä–æ–π—Ç–µ –º–∏–Ω–∏‚Äë–∞–ø–ø –≤–Ω—É—Ç—Ä–∏ Telegram');
  }

  $('#checkout').onclick=sendOrder;
  if(tg) tg.MainButton.onClick(sendOrder);

  // Init
  renderProducts(); setLang('ru');
</script>
</body>
</html>
